root@ubuntu-s-1vcpu-1gb-nyc3-01:~# cd /var/www/career-portal

# Remove the problematic await and fix the server file completely
cat > server/index.cjs << 'EOF'
const express = require('express');
const session = require('express-session');
const MemoryStore = require('memorystore')(session);
const path = require('path');
const fs = require('fs');

console.log('Starting Career Portal server...');

const app = express();
const PORT = process.env.PORT || 5000;

app.set('trust proxy', 1);

app.use(session({
  store: new MemoryStore({
    checkPeriod: 86400000,
    ttl: 86400000
  }),
  secret: 'career-portal-secret-2024',
  resave: false,
  saveUninitialized: false,
  rolling: true,
  cookie: {
    httpOnly: true,
    maxAge: 24 * 60 * 60 * 1000,
    sameSite: 'lax'
  }
}));

app.use(express.json({ limit: '50mb' }));
app.use(express.urlencoded({ extended: true, limit: '50mb' }));

// Static files
const staticPath = path.join(__dirname, '../dist/public');
if (fs.existsSync(staticPath)) {
  app.use(express.static(staticPath));
  console.log('Serving static files from:', staticPath);
}

// Health check
app.get('/health', (req, res) => {
  res.json({
    status: 'healthy',
    timestamp: new Date().toISOString(),
    uptime: Math.floor(process.uptime()),
    staticPath: fs.existsSync(staticPath) ? staticPath : 'not found'
  });
});

// Start server first, then load routes
const server = app.listen(PORT, '0.0.0.0', () => {
  console.log(`✅ Career Portal server running on port ${PORT}`);
  console.log(`🌐 Access at: http://162.243.190.66`);
pm2 statusrequirements":"Test requirements","type":"full-time","location":"remote","status":"active"},"tags":[]}' -s"fullDescription":"Full desc
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [career-portal](ids: [ 0 ])
[PM2] [career-portal](0) ✓
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ career-portal    │ default     │ 1.0.0   │ cluster │ 1322543  │ 0s     │ 6    │ online    │ 0%       │ 48.3mb   │ root     │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴─────���────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
Testing server health:
{"status":"healthy","timestamp":"2025-06-23T19:27:03.487Z","uptime":8,"staticPath":"/var/www/career-portal/dist/public"}
Testing API endpoints:
[]
[{"id":1,"name":"Engineering","description":"Engineering jobs","status":"active","createdAt":"2025-06-23T19:26:57.327Z"},{"id":2,"name":"Marketing","description":"Marketing jobs","status":"active","createdAt":"2025-06-23T19:26:57.327Z"},{"id":3,"name":"Sales","description":"Sales jobs","status":"active","createdAt":"2025-06-23T19:26:57.327Z"}]
Testing authentication:
{"id":1,"username":"admin","email":"admin@theresourceconsultants.com","firstName":"Admin","lastName":"User","fullName":"Admin User","role":"admin","isActive":true,"isSuperAdmin":true,"department":"Management","createdAt":"2025-06-23T19:26:57.327Z","lastLogin":null}
Testing job creation:
{"title":"Production Test Job","department":"Engineering","categoryId":1,"shortDescription":"Test job","fullDescription":"Full description","requirements":"Test requirements","type":"full-time","location":"remote","status":"active","employeeId":1,"id":1,"postedDate":"2025-06-23T19:27:03.800Z","expiryDate":null,"tags":[]}
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ career-portal    │ default     │ 1.0.0   │ cluster │ 1322543  │ 10s    │ 6    │ online    │ 0%       │ 74.5mb   │ root     │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
root@ubuntu-s-1vcpu-1gb-nyc3-01:/var/www/career-portal# 