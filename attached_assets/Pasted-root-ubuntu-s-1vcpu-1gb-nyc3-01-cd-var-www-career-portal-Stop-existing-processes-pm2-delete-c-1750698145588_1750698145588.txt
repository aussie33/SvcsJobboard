root@ubuntu-s-1vcpu-1gb-nyc3-01:~# cd /var/www/career-portal

# Stop existing processes
pm2 delete career-portal 2>/dev/null || true
fuser -k 5000/tcp 2>/dev/null || true

# Create PM2 config as .cjs (CommonJS format)
cat > ecosystem.config.cjs << 'EOF'
module.exports = {
  apps: [{
    name: 'career-portal',
    script: './server/index.js',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 5000,
      SESSION_SECRET: 'career-portal-secret-2024'
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true
  }]
};
EOF

# Remove the problematic .js config
rm -f ecosystem.config.js

# Ensure logs directory exists
mkdir -p logs

# Start with the corrected .cjs config
pm2 start ecosystem.config.cjs
pm2 save

# Verify it's running
pm2 status
curl http://localhost:5000/health
 1212642[PM2][WARN] Applications career-portal not running, starting...
[PM2] App [career-portal] launched (1 instances)
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ career-portal    │ default     │ 1.0.0   │ cluster │ 1213961  │ 0s     │ 0    │ online    │ 0%       │ 48.5mb   │ root     │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ career-portal    │ default     │ 1.0.0   │ cluster │ 1213961  │ 4s     │ 0    │ online    │ 0%       │ 60.7mb   │ root     │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴─────���────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
curl: (7) Failed to connect to localhost port 5000 after 1 ms: Could not connect to server
root@ubuntu-s-1vcpu-1gb-nyc3-01:/var/www/career-portal# 