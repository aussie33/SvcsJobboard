root@ubuntu-s-1vcpu-1gb-nyc3-01:~# cd /var/www/career-portal

# Stop existing processes
pm2 delete career-portal 2>/dev/null || true
fuser -k 5000/tcp 2>/dev/null || true

# Create PM2 config as .cjs (CommonJS format)
cat > ecosystem.config.cjs << 'EOF'
module.exports = {
  apps: [{
    name: 'career-portal',
    script: './server/index.js',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 5000,
      SESSION_SECRET: 'career-portal-secret-2024'
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true
  }]
};
EOF

# Remove the problematic .js config
rm -f ecosystem.config.js

# Ensure logs directory exists
mkdir -p logs

# Start with the corrected .cjs config
pm2 start ecosystem.config.cjs
pm2 save

# Verify it's running
pm2 status
curl http://localhost:5000/health
 1212642[PM2][WARN] Applications career-portal not running, starting...
[PM2] App [career-portal] launched (1 instances)
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ career-portal    │ default     │ 1.0.0   │ cluster │ 1213961  │ 0s     │ 0    │ online    │ 0%       │ 48.5mb   │ root     │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
[PM2] Saving current process list...
[PM2] Successfully saved in /root/.pm2/dump.pm2
┌────┬──────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name             │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ career-portal    │ default     │ 1.0.0   │ cluster │ 1213961  │ 4s     │ 0    │ online    │ 0%       │ 60.7mb   │ root     │ disabled │
└────┴──────────────────┴─────────────┴─────────┴─────────┴─────���────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
curl: (7) Failed to connect to localhost port 5000 after 1 ms: Could not connect to server
root@ubuntu-s-1vcpu-1gb-nyc3-01:/var/www/career-portal# cd /var/www/career-portal

# Check what's actually happening
pm2 logs career-portal --lines 10

# Check if anything is listening on port 5000
netstat -tlnp | grep 5000

# Fix the server file for ES/CommonJS compatibility
cat > server/index.js << 'EOF'
const express = require('express');
const session = require('express-session');
const MemoryStore = require('memorystore')(session);
const path = require('path');
const fs = require('fs');

async function startServer() {
  console.log('Starting Career Portal server...');
  
  let storage, registerRoutes;
  
  // Try to load modules (handle both ES and CommonJS)
  try {
    // Try ES modules first
    const storageModule = await import('./storage.js');
    const routesModule = await import('./routes.js');
    storage = storageModule.storage;
    registerRoutes = routesModule.registerRoutes;
  } catch (error) {
    console.log('ES modules failed, trying CommonJS...');
    // Fallback to CommonJS
    const storageModule = require('./storage');
    const routesModule = require('./routes');
    storage = storageModule.storage;
    registerRoutes = routesModule.registerRoutes;
  }
  
  const app = express();
  const PORT = process.env.PORT || 5000;

  app.set('trust proxy', 1);

  app.use(session({
    store: new MemoryStore({
      checkPeriod: 86400000,
      ttl: 86400000
    }),
    secret: 'career-portal-secret-2024',
    resave: false,
    saveUninitialized: false,
    rolling: true,
    cookie: {
      httpOnly: true,
      maxAge: 24 * 60 * 60 * 1000
    }
  }));

pm2 statusatuscalhost:5000/health);port ${PORT}`);nning</p>');tring() });
[TAILING] Tailing last 10 lines for [career-portal] process (change the value with --lines option)
/var/www/career-portal/logs/out-0.log last 10 lines:
/var/www/career-portal/logs/err-0.log last 10 lines:
0|career-p | You have triggered an unhandledRejection, you may have forgotten to catch a Promise rejection:
0|career-p | ReferenceError: require is not defined in ES module scope, you can use import instead
0|career-p | This file is being treated as an ES module because it has a '.js' file extension and '/var/www/career-portal/package.json' contains "type": "module". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.
0|career-p |     at file:///var/www/career-portal/server/index.js:1:17
0|career-p |     at ModuleJob.run (node:internal/modules/esm/module_job:222:25)
0|career-p |     at async ModuleLoader.import (node:internal/modules/esm/loader:316:24)